\documentclass[varwidth, border=20pt]{standalone}
\usepackage{algpseudocode}
\usepackage{algorithmicx}  
\usepackage{amsmath}
\usepackage{microtype}      
\usepackage{caption}
\usepackage{graphicx}


\captionsetup{labelfont=bf, font=small}
\renewcommand{\algorithmiccomment}[1]{\hfill\(\triangleright\) #1}
\newcommand{\algspace}{\vspace{3pt}}

\begin{document}

\begingroup
\small                    
\begin{center}
  \begin{minipage}{0.99\linewidth} 
    \hrule height 0.7pt
    \vspace{3pt}
    Algorithm: QMIX Training
    \vspace{3pt}
    \hrule height 0.7pt
    \vspace{6pt}

   
    \begin{algorithmic}[1]
      \State Initialize: $\theta$ and  $\theta^-$ the parameters of individual and target Q-networks $Q_i$, $\phi$ and $\phi^-$ the parameters of the mixing and target-mixing network $m$.
      \State Initialize replay buffer $\mathcal{D}$ // $(episode_1, episode_2, \dots)$
      \While{$t < T$}
        \State $current\_episode = \{ \}$ 
        \While{ $\mathbf{o}_t$ is not $done$}
        \State Collect observations $\{o^t_1,\dots,o^t_n\}$ and state $\mathbf{s}_t$
          \For{each agent $i$}
              \State With probability $\epsilon$, select random action $a_i^t$
              \State otherwise select $a_i^t = \arg\max_{a_i} Q_i(o^t_i,a_i)$
         \EndFor
         \State Execute joint action $\mathbf{a}^t = (a_1^t,\dots,a_n^t)$
         \State Collect $r^t$, $done^t$, $\mathbf{o}^{t+1}$, and $\mathbf{s}_{t+1}$
         \State Store $(\mathbf{o}^t,\mathbf{a}^t,r^t,done^t,\mathbf{o}^{t+1})$ in $current\_episode$
        \EndWhile
        \State Store $current\_episode$ in the replay buffer $\mathcal{D}$
        
        \If{$t$ is a training step}
          \State Sample batch of episodes 
          \[ 
            \mathcal{B} = \{ \{\mathbf{s}^{t,b},\mathbf{o}^{t,b},\mathbf{a}^{t,b},r^{t,b},done^{t,b},\mathbf{s'}^{t,b},\mathbf{o'}^{t,b}\}_{t=1 ... L^b}\}_{b=1, ..., |\mathcal{B}|}\]
          \State Set the targets
          \Statex
          \begin{align*}
            y^{t,b} &= r^{t,b} + \gamma (1 - done^{t,b}) \times \\
            &\quad \max_{(a_1, \dots, a_n)} m(\mathbf{s'}^{t,b}, Q_1(\mathbf{o}_1^{t,b}, a_1;\theta^-), \dots, Q_n(\mathbf{o}_n^{t,b}, a_n;\theta^-); \phi^-)
            \end{align*}
            
          \State Perform a gradient descent using:
          \Statex
          \[
            \mathcal{L}(\theta)=\tfrac{1}{|\mathcal{B}|}\sum_b \tfrac{1}{L^b} \Big(y^{t,b}- Q^{tot}(\mathbf{s}^{t,b}\mathbf{o}^{t,b},\mathbf{a}^{t,b};\theta, \phi)\Big)^2
          \]
          \State Every $C$ steps, update $\theta^- \leftarrow \theta$, $\phi^- \leftarrow \phi$ 
        \EndIf
      \EndWhile
    \end{algorithmic}

    \vspace{6pt}
    \hrule height 0.7pt
  \end{minipage}
\end{center}
\endgroup

\end{document}
